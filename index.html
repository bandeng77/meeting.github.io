<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meeting Scheduler Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBWD1l0RXGWMG7hFc9uGsjlZkOW_0Job2k",
      authDomain: "meetingefk.firebaseapp.com",
      databaseURL: "https://meetingefk-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "meetingefk",
      storageBucket: "meetingefk.firebasestorage.app",
      messagingSenderId: "664314278395",
      appId: "1:664314278395:web:5eac88372b15c6170b1b5e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <style>
    .calendar-day {
      transition: all 0.2s ease;
    }
    .calendar-day:hover:not(.disabled) {
      background-color: #EFF6FF;
      cursor: pointer;
    }
    .calendar-day.selected {
      background-color: #3B82F6;
      color: white;
    }
    .calendar-day.has-meetings {
      position: relative;
    }
    .calendar-day.has-meetings::after {
      content: '';
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: #3B82F6;
    }
    .calendar-day.selected.has-meetings::after {
      background-color: white;
    }
    .time-slot:hover:not(.booked) {
      background-color: #EFF6FF;
      cursor: pointer;
    }
    .time-slot.selected {
      background-color: #3B82F6;
      color: white;
    }
    .meeting-card {
      transition: all 0.2s ease;
    }
    .meeting-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Left Column - Calendar -->
      <div class="w-full lg:w-2/5 bg-white rounded-xl shadow-md overflow-hidden">
        <div class="p-6">
          <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">Meeting Scheduler</h1>
            <div class="flex items-center space-x-2">
              <select id="month-select" class="border border-gray-300 rounded-md px-2 py-1 text-sm"></select>
              <select id="year-select" class="border border-gray-300 rounded-md px-2 py-1 text-sm"></select>
            </div>
          </div>

          <div id="calendar-header" class="grid grid-cols-7 gap-1 mb-2">
            <div class="text-center text-sm font-medium text-gray-500">Sun</div>
            <div class="text-center text-sm font-medium text-gray-500">Mon</div>
            <div class="text-center text-sm font-medium text-gray-500">Tue</div>
            <div class="text-center text-sm font-medium text-gray-500">Wed</div>
            <div class="text-center text-sm font-medium text-gray-500">Thu</div>
            <div class="text-center text-sm font-medium text-gray-500">Fri</div>
            <div class="text-center text-sm font-medium text-gray-500">Sat</div>
          </div>

          <div id="calendar-grid" class="grid grid-cols-7 gap-1">
            <!-- Calendar days will be dynamically generated here -->
          </div>

          <!-- Selected Date Display -->
          <div id="selected-date-display" class="mt-6 p-4 bg-blue-50 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-800">Selected Date</h3>
            <p id="selected-date" class="text-blue-600 font-medium mt-1">No date selected</p>
          </div>

          <!-- Time Slots -->
          <div id="time-slots" class="mt-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Available Time Slots</h3>
            <div class="grid grid-cols-3 gap-2">
              <!-- Time slots will be dynamically generated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Meetings and Booking Form -->
      <div class="w-full lg:w-3/5 space-y-6">
        <!-- Meetings List -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Meetings on <span id="meetings-date">Selected Date</span></h2>
            <div id="meetings-list" class="space-y-3">
              <!-- Meeting items will be inserted here -->
              <div class="text-center py-8 text-gray-500">
                <p>No meetings scheduled yet</p>
                <p class="text-sm mt-2">Select a date to view or schedule meetings</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Booking Form -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Schedule New Meeting</h2>
            <form id="booking-form">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Meeting Title</label>
                  <input type="text" id="title" name="title" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                  <label for="participants" class="block text-sm font-medium text-gray-700 mb-1">Participants</label>
                  <input type="text" id="participants" name="participants" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Emails, comma separated">
                </div>
                <div>
                  <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                  <input type="text" id="date" name="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100" readonly>
                </div>
                <div>
                  <label for="time" class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                  <input type="text" id="time" name="time" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100" readonly>
                </div>
                <div class="md:col-span-2">
                  <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                  <textarea id="description" name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
              </div>
              <button type="submit" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition duration-150 ease-in-out">
                Schedule Meeting
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
<script>
  // Firebase meetings object
  let meetingsData = {};
  const availableTimes = ['09:00', '10:00', '11:00', '13:00', '14:00', '15:00', '16:00'];

  let currentMonth = new Date().getMonth();
  let currentYear = new Date().getFullYear();
  let selectedDate = null;
  let selectedTime = null;

  // DOM
  const calendarGrid = document.getElementById('calendar-grid');
  const selectedDateDisplay = document.getElementById('selected-date');
  const meetingsDateDisplay = document.getElementById('meetings-date');
  const meetingsList = document.getElementById('meetings-list');
  const bookingForm = document.getElementById('booking-form');
  const bookingDateInput = document.getElementById('date');
  const bookingTimeInput = document.getElementById('time');
  const monthSelect = document.getElementById('month-select');
  const yearSelect = document.getElementById('year-select');

  function populateMonthYearDropdown() {
    const monthNames = [...Array(12)].map((_, i) =>
      new Date(0, i).toLocaleString('default', { month: 'long' })
    );
    monthNames.forEach((month, i) => {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = month;
      monthSelect.appendChild(option);
    });

    const startYear = new Date().getFullYear();
    for (let y = startYear; y <= startYear + 1; y++) {
      const option = document.createElement('option');
      option.value = y;
      option.textContent = y;
      yearSelect.appendChild(option);
    }

    monthSelect.value = currentMonth;
    yearSelect.value = currentYear;
  }

  monthSelect.addEventListener('change', () => {
    currentMonth = parseInt(monthSelect.value);
    renderCalendar(currentMonth, currentYear);
  });

  yearSelect.addEventListener('change', () => {
    currentYear = parseInt(yearSelect.value);
    renderCalendar(currentMonth, currentYear);
  });

  function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  function renderCalendar(month, year) {
    calendarGrid.innerHTML = '';

    const firstDay = new Date(year, month, 1);
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const startingDay = firstDay.getDay();
    const prevMonthDays = new Date(year, month, 0).getDate();

    for (let i = 0; i < startingDay; i++) {
      const dayElement = createDayElement(prevMonthDays - startingDay + i + 1, true);
      calendarGrid.appendChild(dayElement);
    }

    for (let i = 1; i <= daysInMonth; i++) {
      const date = new Date(year, month, i);
      const dateString = formatDate(date);
      const hasMeetings = meetingsData[dateString] && meetingsData[dateString].length > 0;
      const isSelected = selectedDate && date.toDateString() === selectedDate.toDateString();
      const isToday = date.toDateString() === new Date().toDateString();
      const dayElement = createDayElement(i, false, hasMeetings, isSelected, isToday);
      dayElement.addEventListener('click', () => selectDate(date, dateString));
      calendarGrid.appendChild(dayElement);
    }

    const totalCells = startingDay + daysInMonth;
    const remainingCells = totalCells <= 35 ? 35 - totalCells : 42 - totalCells;
    for (let i = 1; i <= remainingCells; i++) {
      const dayElement = createDayElement(i, true);
      calendarGrid.appendChild(dayElement);
    }
  }

  function createDayElement(day, isDisabled, hasMeetings = false, isSelected = false, isToday = false) {
    const el = document.createElement('div');
    el.className = 'calendar-day py-2 text-center rounded-md';
    if (isDisabled) {
      el.classList.add('text-gray-300', 'disabled');
    } else {
      el.classList.add('text-gray-800');
      if (isToday) el.classList.add('font-bold', 'border', 'border-blue-500');
      if (hasMeetings) el.classList.add('has-meetings');
      if (isSelected) el.classList.add('selected', 'text-white');
    }
    el.textContent = day;
    return el;
  }

  function selectDate(date, dateString) {
    selectedDate = date;
    selectedTime = null;
    selectedDateDisplay.textContent = date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    meetingsDateDisplay.textContent = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
    bookingDateInput.value = dateString;
    bookingTimeInput.value = '';
    renderCalendar(currentMonth, currentYear);
    updateMeetingsList(dateString);
    updateTimeSlots();
  }

  async function fetchMeetings() {
    const snapshot = await db.ref('meetings').once('value');
    const data = snapshot.val();
    meetingsData = {};
    if (data) {
      Object.values(data).forEach(meeting => {
        if (!meetingsData[meeting.date]) meetingsData[meeting.date] = [];
        meetingsData[meeting.date].push(meeting);
      });
    }
    renderCalendar(currentMonth, currentYear);
    if (selectedDate) {
      const dateString = formatDate(selectedDate);
      updateMeetingsList(dateString);
      updateTimeSlots();
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    populateMonthYearDropdown();
    fetchMeetings();
    const today =
<script>
  function updateMeetingsList(dateString) {
    meetingsList.innerHTML = '';
    const meetings = meetingsData[dateString];

    if (!meetings || meetings.length === 0) {
      meetingsList.innerHTML = `
        <div class="text-center py-8 text-gray-500">
          <p>No meetings scheduled for this date</p>
          <p class="text-sm mt-2">Select a time slot below to schedule a meeting</p>
        </div>`;
      return;
    }

    meetings.forEach(meeting => {
      const el = document.createElement('div');
      el.className = 'meeting-card p-4 border border-gray-200 rounded-lg';
      el.innerHTML = `
        <div class="flex justify-between items-start">
          <div>
            <h3 class="font-semibold text-gray-800">${meeting.title}</h3>
            <p class="text-sm text-gray-500 mt-1">${meeting.time}</p>
          </div>
          <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Scheduled</span>
        </div>
        <p class="text-sm text-gray-600 mt-2">${meeting.description}</p>
        <div class="mt-3">
          <h4 class="text-xs font-medium text-gray-500 uppercase tracking-wider">Participants</h4>
          <p class="text-xs mt-1">${meeting.participants.join(', ')}</p>
        </div>`;
      meetingsList.appendChild(el);
    });
  }

  function updateTimeSlots() {
    const container = document.querySelector('#time-slots .grid');
    container.innerHTML = '';

    if (!selectedDate) return;

    const dateString = formatDate(selectedDate);
    const booked = meetingsData[dateString] ? meetingsData[dateString].map(m => m.time) : [];

    availableTimes.forEach(time => {
      const isBooked = booked.includes(time);
      const slot = document.createElement('div');
      slot.className = `time-slot py-2 px-3 text-center rounded-md border ${isBooked ? 'bg-gray-100 text-gray-400 border-gray-200 booked' : 'border-gray-200'}`;
      slot.textContent = time;

      if (!isBooked) {
        if (selectedTime === time) {
          slot.classList.add('selected', 'text-white', 'border-blue-500');
        }
        slot.addEventListener('click', () => {
          document.querySelectorAll('.time-slot').forEach(s => {
            s.classList.remove('selected', 'text-white', 'border-blue-500');
          });
          slot.classList.add('selected', 'text-white', 'border-blue-500');
          selectedTime = time;
          bookingTimeInput.value = time;
        });
      }

      container.appendChild(slot);
    });
  }

  bookingForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    if (!selectedDate || !selectedTime) {
      alert('Please select a date and time');
      return;
    }

    const title = document.getElementById('title').value;
    const participants = document.getElementById('participants').value
      .split(',').map(p => p.trim()).filter(p => p);
    const description = document.getElementById('description').value;
    const dateString = formatDate(selectedDate);
    const newMeeting = {
      id: Date.now(),
      title,
      time: selectedTime,
      participants,
      description,
      date: dateString
    };

    await db.ref('meetings').push(newMeeting);

    alert('Meeting scheduled successfully!');
    bookingForm.reset();
    selectedTime = null;
    bookingTimeInput.value = '';

    await fetchMeetings();
  });
</script>
</body>
</html>
