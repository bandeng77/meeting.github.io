<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Scheduler Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
        }
        
        .calendar-header {
            background-color: var(--primary);
            transition: all 0.3s ease;
        }
        
        .calendar-header:hover {
            background-color: var(--secondary);
        }
        
        .meeting-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid var(--accent);
        }
        
        .meeting-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .time-slot {
            transition: all 0.2s ease;
        }
        
        .time-slot:hover {
            background-color: var(--accent);
            color: white;
        }
        
        .time-slot.selected {
            background-color: var(--primary);
            color: white;
        }
        
        #calendar {
            max-height: 600px;
            overflow-y: auto;
        }
        
        @media (max-width: 768px) {
            .responsive-flex {
                flex-direction: column;
            }
            
            #calendar {
                max-height: 400px;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Meeting Scheduler Pro</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">Easily schedule meetings and send invitations with just a few clicks</p>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg overflow-hidden responsive-flex">
            <!-- Calendar Section -->
            <div class="w-full lg:w-1/2 p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Calendar</h2>
                    <div>
                        <button id="prevMonth" class="px-3 py-1 rounded-lg hover:bg-gray-100">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="currentMonth" class="mx-4 font-medium"></span>
                        <button id="nextMonth" class="px-3 py-1 rounded-lg hover:bg-gray-100">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div id="calendar" class="grid grid-cols-7 gap-1 mb-6">
                    <!-- Calendar days will be generated by JavaScript -->
                </div>
                
                <div class="mt-6">
                    <h3 class="text-lg font-medium mb-3">Meeting Schedule</h3>
                    <div id="timeSlots" class="grid grid-cols-4 gap-2">
                        <!-- Time slots will be generated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Meeting Form Section -->
            <div class="w-full lg:w-1/2 bg-gray-50 p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Schedule New Meeting</h2>
                
                <form id="meetingForm" class="space-y-4">
                    <div>
                        <label for="meetingTitle" class="block text-sm font-medium text-gray-700 mb-1">Meeting Title</label>
                        <input type="text" id="meetingTitle" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="meetingDate" class="block text-sm font-medium text-gray-700 mb-1">Date & Time</label>
                        <input type="text" id="meetingDate" readonly class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-gray-100">
                    </div>
                    
                    <div>
                        <label for="meetingDuration" class="block text-sm font-medium text-gray-700 mb-1">Duration</label>
                        <select id="meetingDuration" class="w-full px-4 py-2 rounded-lg border border-gray-300">
                            <option value="30">30 minutes</option>
                            <option value="60" selected>1 hour</option>
                            <option value="90">1.5 hours</option>
                            <option value="120">2 hours</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="organizerEmail" class="block text-sm font-medium text-gray-700 mb-1">Your Email</label>
                        <input type="email" id="organizerEmail" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="participantEmails" class="block text-sm font-medium text-gray-700 mb-1">Participant Emails (comma separated)</label>
                        <textarea id="participantEmails" rows="3" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                    
                    <div>
                        <label for="meetingDescription" class="block text-sm font-medium text-gray-700 mb-1">Meeting Description</label>
                        <textarea id="meetingDescription" rows="4" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                    
                    <div class="pt-2">
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                            <i class="fas fa-calendar-plus mr-2"></i> Schedule & Send Invites
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Upcoming Meetings Section -->
        <div class="mt-12">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Upcoming Meetings</h2>
            <div id="upcomingMeetings" class="space-y-4">
                <!-- Meetings will be generated here -->
                <div class="text-center py-8 text-gray-500" id="noMeetingsMessage">
                    <i class="fas fa-calendar-alt text-4xl mb-3"></i>
                    <p>No upcoming meetings scheduled yet.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBWD1l0RXGWMG7hFc9uGsjlZkOW_0Job2k",
            authDomain: "meetingefk.firebaseapp.com",
            databaseURL: "https://meetingefk-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "meetingefk",
            storageBucket: "meetingefk.firebasestorage.app",
            messagingSenderId: "664314278395",
            appId: "1:664314278395:web:5eac88372b15c6170b1b5e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Current date and selected date
        let currentDate = new Date();
        let selectedDate = new Date();
        let selectedTime = null;
        
        // Meetings data from Firebase
        let meetings = [];
        
        // Initialize the calendar and load meetings from Firebase
        document.addEventListener('DOMContentLoaded', function() {
            // Load meetings from Firebase
            database.ref('meetings').on('value', (snapshot) => {
                meetings = [];
                snapshot.forEach((childSnapshot) => {
                    meetings.push(childSnapshot.val());
                });
                generateTimeSlots();
                displayUpcomingMeetings();
            });
            // Generate current month calendar
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            
            // Update the current month display
            updateMonthDisplay();
            
            // Generate time slots
            generateTimeSlots();
            
            // Display any existing meetings
            displayUpcomingMeetings();
            
            // Setup event listeners
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // Month navigation
            document.getElementById('prevMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
                updateMonthDisplay();
            });
            
            document.getElementById('nextMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
                updateMonthDisplay();
            });
            
            // Form submission
            document.getElementById('meetingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                scheduleMeeting();
            });
            
            // Click event for time slots (event delegation)
            document.getElementById('timeSlots').addEventListener('click', function(e) {
                if (e.target.classList.contains('time-slot')) {
                    // Remove selected class from all time slots
                    document.querySelectorAll('.time-slot').forEach(slot => {
                        slot.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked time slot
                    e.target.classList.add('selected');
                    selectedTime = e.target.getAttribute('data-time');
                    
                    // Update the meeting date input
                    updateMeetingDateInput();
                }
            });
        }
        
        function generateCalendar(year, month) {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            
            // Create day headers (Sun-Sat)
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-medium text-gray-600 py-2';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Get first day of month and total days in month
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'h-12 md:h-16';
                calendar.appendChild(emptyCell);
            }
            
            // Add cells for each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayCell = document.createElement('div');
                dayCell.className = 'border border-gray-200 h-12 md:h-16 p-1 cursor-pointer hover:bg-gray-100 transition';
                
                // Highlight today
                const today = new Date();
                if (date.getDate() === today.getDate() && 
                    date.getMonth() === today.getMonth() && 
                    date.getFullYear() === today.getFullYear()) {
                    dayCell.classList.add('bg-blue-100');
                }
                
                // Highlight selected date
                if (date.getDate() === selectedDate.getDate() && 
                    date.getMonth() === selectedDate.getMonth() && 
                    date.getFullYear() === selectedDate.getFullYear()) {
                    dayCell.classList.add('bg-blue-200', 'font-medium');
                }
                
                dayCell.innerHTML = `
                    <div class="text-right text-sm">${day}</div>
                    <div class="text-xs truncate">
                        ${getMeetingsForDay(date).map(m => `<span class="inline-block w-2 h-2 rounded-full bg-blue-500 mr-1"></span>`).join('')}
                    </div>
                `;
                
                // Add click event to select date
                dayCell.addEventListener('click', function() {
                    selectedDate = date;
                    generateCalendar(year, month);
                    generateTimeSlots();
                    updateMeetingDateInput();
                });
                
                calendar.appendChild(dayCell);
            }
        }
        
        function generateTimeSlots() {
            const timeSlots = document.getElementById('timeSlots');
            timeSlots.innerHTML = '';
            
            // Generate time slots from 8AM to 6PM
            for (let hour = 8; hour <= 18; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot text-center py-2 rounded-lg border border-gray-200 cursor-pointer text-sm';
                    timeSlot.setAttribute('data-time', timeString);
                    timeSlot.textContent = timeString;
                    
                    // Check if this time is already booked
                    const isBooked = meetings.some(meeting => {
                        const meetingDate = new Date(meeting.date);
                        return meetingDate.getDate() === selectedDate.getDate() && 
                               meetingDate.getMonth() === selectedDate.getMonth() && 
                               meetingDate.getFullYear() === selectedDate.getFullYear() && 
                               meeting.time === timeString;
                    });
                    
                    if (isBooked) {
                        timeSlot.classList.add('bg-gray-200', 'text-gray-500');
                        timeSlot.classList.remove('hover:bg-blue-500', 'cursor-pointer');
                    }
                    
                    timeSlots.appendChild(timeSlot);
                }
            }
        }
        
        function updateMonthDisplay() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonth').textContent = 
                `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
        }
        
        function getMeetingsForDay(date) {
            return meetings.filter(meeting => {
                const meetingDate = new Date(meeting.date);
                return meetingDate.getDate() === date.getDate() && 
                       meetingDate.getMonth() === date.getMonth() && 
                       meetingDate.getFullYear() === date.getFullYear();
            });
        }
        
        function updateMeetingDateInput() {
            if (!selectedTime) return;
            
            const formattedDate = selectedDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('meetingDate').value = 
                `${formattedDate} at ${selectedTime}`;
        }
        
        function scheduleMeeting() {
            if (!selectedTime) {
                alert('Please select a time slot');
                return;
            }
            
            // Create meeting object
            const meeting = {
                id: Date.now().toString(),
                title: document.getElementById('meetingTitle').value,
                date: selectedDate.toISOString(),
                time: selectedTime,
                duration: document.getElementById('meetingDuration').value,
                organizer: document.getElementById('organizerEmail').value,
                participants: document.getElementById('participantEmails').value.split(',').map(email => email.trim()),
                description: document.getElementById('meetingDescription').value,
                createdAt: new Date().toISOString()
            };
            
            // Save meeting to Firebase
            database.ref('meetings/' + meeting.id).set(meeting)
                .then(() => {
                    // Send email invitation
                    sendEmailInvitation(meeting);
                    
                    // Reset form
                    document.getElementById('meetingForm').reset();
                    selectedTime = null;
                    document.getElementById('meetingDate').value = '';
                    document.querySelectorAll('.time-slot').forEach(slot => {
                        slot.classList.remove('selected');
                    });
                    
                    // Show success message
                    alert('Meeting scheduled and invitations sent successfully!');
                })
                .catch((error) => {
                    alert('Error saving meeting: ' + error.message);
                });
            
            // Reset form
            document.getElementById('meetingForm').reset();
            selectedTime = null;
            document.getElementById('meetingDate').value = '';
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Update UI
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            generateTimeSlots();
            displayUpcomingMeetings();
            
            // Show success message
            alert('Meeting scheduled and invitations sent successfully!');
        }
        
        function sendEmailInvitation(meeting) {
            // In a real application, this would send actual emails using a service like SendGrid or your backend
            console.log('Email sent to participants:', meeting.participants);
            
            // This is a simulation - in a real app you would:
            // 1. Call your backend API to send emails
            // 2. Or use a service like EmailJS or SendGrid directly from frontend
            // 3. Or implement server-side email functionality
            
            // Example of what the email content might look like:
            const emailContent = `
                Subject: Invitation: ${meeting.title}
                
                Dear Participant,
                
                You have been invited to a meeting:
                
                Title: ${meeting.title}
                Date: ${new Date(meeting.date).toLocaleDateString()}
                Time: ${meeting.time}
                Duration: ${meeting.duration} minutes
                Organized by: ${meeting.organizer}
                
                Description:
                ${meeting.description}
                
                Please let us know if you can attend.
                
                Best regards,
                Meeting Scheduler Pro
            `;
            
            console.log('Email content:\n', emailContent);
        }
        
        function displayUpcomingMeetings() {
            const upcomingMeetingsContainer = document.getElementById('upcomingMeetings');
            const noMeetingsMessage = document.getElementById('noMeetingsMessage');
            
            // Filter upcoming meetings (from now onwards)
            const now = new Date();
            const upcoming = meetings
                .filter(meeting => new Date(meeting.date) >= now)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            if (upcoming.length === 0) {
                noMeetingsMessage.style.display = 'block';
                upcomingMeetingsContainer.innerHTML = '';
                return;
            }
            
            noMeetingsMessage.style.display = 'none';
            upcomingMeetingsContainer.innerHTML = '';
            
            upcoming.forEach(meeting => {
                const meetingDate = new Date(meeting.date);
                const meetingElement = document.createElement('div');
                meetingElement.className = 'meeting-card bg-white rounded-lg shadow p-5';
                
                const formattedDate = meetingDate.toLocaleDateString('en-US', {
                    weekday: 'long',
                    month: 'long',
                    day: 'numeric',
                    year: 'numeric'
                });
                
                meetingElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-xl font-semibold">${meeting.title}</h3>
                            <p class="text-gray-600 mt-1">
                                <i class="fas fa-calendar-day mr-2"></i>
                                ${formattedDate} at ${meeting.time}
                            </p>
                            <p class="text-gray-600">
                                <i class="fas fa-clock mr-2"></i>
                                Duration: ${meeting.duration} minutes
                            </p>
                            <p class="text-gray-600">
                                <i class="fas fa-user mr-2"></i>
                                Organized by: ${meeting.organizer}
                            </p>
                            <p class="text-gray-600 mt-2">
                                <i class="fas fa-users mr-2"></i>
                                Participants: ${meeting.participants.join(', ')}
                            </p>
                            ${meeting.description ? `
                            <div class="mt-3 p-3 bg-gray-50 rounded">
                                <p class="font-medium text-gray-700">Meeting Notes:</p>
                                <p class="text-gray-600 mt-1">${meeting.description}</p>
                            </div>
                            ` : ''}
                        </div>
                        <button class="delete-meeting px-3 py-1 rounded-lg text-red-500 hover:bg-red-50" data-id="${meeting.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                upcomingMeetingsContainer.appendChild(meetingElement);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-meeting').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteMeeting(id);
                });
            });
        }
        
        function deleteMeeting(id) {
            if (confirm('Are you sure you want to delete this meeting?')) {
                database.ref('meetings/' + id).remove()
                    .then(() => {
                        meetings = meetings.filter(meeting => meeting.id !== id);
                        displayUpcomingMeetings();
                        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
                        generateTimeSlots();
                    })
                    .catch((error) => {
                        alert('Error deleting meeting: ' + error.message);
                    });
            }
        }
    </script>
</body>
</html>

